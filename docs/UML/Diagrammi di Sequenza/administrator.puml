@startuml
actor Amministratore
participant "UserPanelController" as Controller
participant "PopupBuilder" as UI
participant "UserPanelService" as Gestore
participant "Database" as DB

== Flusso normale ==
Amministratore -> Controller : clicca "Gestione Admin" (handleAdmin)
Controller -> UI : new PopupBuilder()
Controller -> Gestore : getAllUsersExceptCurrent()
Gestore -> DB : SELECT * FROM utenti WHERE id != currentUser
DB --> Gestore : lista utenti con ruoli
Gestore --> Controller : lista utenti
Controller -> UI : mostra popup con toggle per ogni utente

Amministratore -> UI : clic sul toggle (ON)
UI -> Controller : richiesta promozione dell'utente
Controller -> Gestore : promoteUser(nomeUtente)
Gestore -> DB : UPDATE utenti SET ruolo = 'ADMIN' WHERE nome = ...
DB --> Gestore : conferma aggiornamento
Gestore --> Controller : successo
Controller -> UI : mostra conferma promozione
UI -> Amministratore : ruolo aggiornato

== Flusso alternativo ==
alt Errore durante aggiornamento ruolo
    DB --> Gestore : errore nell'UPDATE
    Gestore --> Controller : errore
    Controller -> UI : mostra messaggio di errore
    UI -> Amministratore : errore durante l'aggiornamento
end
@enduml