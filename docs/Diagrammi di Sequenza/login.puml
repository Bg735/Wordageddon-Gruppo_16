@startuml
actor Utente
participant AuthController
participant AppContext
participant AuthService
participant UserDAO
database Database
participant View

activate Utente
Utente -> AuthController : inserisce username e password
activate AuthController

AuthController -> AppContext : getAuthService()
activate AppContext
AppContext --> AuthController : return AuthService
deactivate AppContext

AuthController -> AuthService : login(username, password)
activate AuthService

AuthService -> UserDAO : selectById(username)
activate UserDAO

UserDAO -> Database : SELECT * FROM User WHERE name = ?
activate Database
Database --> UserDAO : return User (o null)
deactivate Database

UserDAO --> AuthService : return User
deactivate UserDAO

AuthService -> AuthService : verifica password

alt login valido

    AuthService -> AppContext : setCurrentUser(user)
    activate AppContext
    deactivate AppContext
    AuthService->AuthService: saveSession(user)
    AuthService --> AuthController : ritorna true
    AuthController -> View : carica schermata MainMenu
    activate View
    deactivate View
else login fallito
    AuthService --> AuthController : return false
    AuthController -> View :  showDialog()
    note right of AuthController
        Mostra messaggio di errore all'utente
    end note
    activate View
    deactivate View
end

deactivate AuthService
deactivate AuthController
deactivate Utente
@enduml